<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="title"
      content="SPD Pre-Audit Assessment | CrownPoint Consulting"
    />
    <meta
      name="description"
      content="Professional SPD operational review and pre-audit tool. Streamlines sterile processing data collection for facility identity, staffing, and regulatory compliance."
    />
    <meta name="author" content="CrownPointConsulting" />
    <link rel="icon" type="image/svg+xml" href="favicon/favicon.svg" />
    <link
      rel="icon"
      type="image/png"
      href="favicon/favicon-96x96.png"
      sizes="96x96"
    />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="favicon/apple-touch-icon.png"
    />
    <link rel="manifest" href="favicon/site.webmanifest" />
    <meta property="og:type" content="website" />
    <meta
      property="og:url"
      content="https://crownpointconsulting.com/schedule"
    />
    <meta
      property="og:title"
      content="SPD Pre-Audit Assessment | CrownPoint Consulting"
    />
    <meta
      property="og:description"
      content="Evaluate SPD operational efficiency and survey readiness with our digital pre-audit tool."
    />
    <meta property="og:image" content="assets/cleanroom.png" />
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:title" content="SPD Pre-Audit Assessment" />
    <meta property="twitter:image" content="assets/bg_less_logo.png" />
    <title>Pre-Audit Assessment | CrownPoint Consulting</title>

    <!-- Fonts + Tailwind -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React + Babel + Zod -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/zod@3.21.4/lib/index.umd.js"></script>

    <!-- PDF libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- SWEETALERT2 (Swal) -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#faf5ff",
                100: "#f3e8ff",
                500: "#a855f7",
                600: "#9333ea",
                700: "#7e22ce",
              },
              accent: {
                400: "#f472b6",
                500: "#ec4899",
                600: "#db2777",
              },
            },
            fontFamily: {
              display: ["Playfair Display", "serif"],
              sans: ["Inter", "sans-serif"],
            },
            boxShadow: {
              soft: "0 18px 45px -18px rgba(15,23,42,0.35)",
            },
          },
        },
      };
    </script>

    <style>
      body {
        font-family: "Inter", sans-serif;
        background: radial-gradient(
          circle at top,
          #faf5ff 0%,
          #f8fafc 45%,
          #eef2ff 100%
        );
      }
      .form-card {
        background: white;
        border-radius: 1.5rem;
        box-shadow: 0 20px 40px -24px rgba(15, 23, 42, 0.4);
      }
      .hp-field {
        position: absolute;
        left: -5000px;
        top: -5000px;
      }
      input::-webkit-outer-spin-button,
      input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
      /* Autocomplete override */
      input:-webkit-autofill,
      input:-webkit-autofill:hover,
      input:-webkit-autofill:focus,
      input:-webkit-autofill:active {
        -webkit-box-shadow: 0 0 30px #f8fafc inset !important;
        box-shadow: 0 0 30px #f8fafc inset !important;
        -webkit-text-fill-color: #475569 !important;
        transition: background-color 5000s ease-in-out 0s;
      }
    </style>
  </head>

  <body class="min-h-screen text-slate-900">
    <div class="relative overflow-hidden">
      <!-- decorative gradient blob -->

      <div id="root" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-10"></div>
    </div>

    <script type="text/babel">
      const { useState, useRef, useCallback } = React;
      const z = Zod;
      const today = new Date().toISOString().split("T")[0];

      /* ---------- Swal Helpers ---------- */
      function createToast() {
        return Swal.mixin({
          toast: true,
          position: "top-end",
          showConfirmButton: false,
          timer: 2000,
          timerProgressBar: true,
          didOpen: (toast) => {
            toast.addEventListener("mouseenter", Swal.stopTimer);
            toast.addEventListener("mouseleave", Swal.resumeTimer);
          },
        });
      }

      const toast = createToast();

      function showSuccessToast(title = "Saved") {
        toast.fire({ icon: "success", title });
      }

      function showErrorToast(title = "Something went wrong") {
        toast.fire({ icon: "error", title });
      }

      async function showSubmissionModal({ facilityName, onDownload, onNew }) {
        const { isConfirmed, isDenied } = await Swal.fire({
          title: "Assessment captured",
          html: `<div class="text-left"><p class="mb-2">Facility: <strong>${facilityName || ""}</strong></p><p class="text-sm text-slate-600">Your assessment was recorded. You can download a PDF copy or start a new assessment.</p></div>`,
          icon: "success",
          showDenyButton: true,
          showCancelButton: true,
          confirmButtonText: "Download PDF",
          denyButtonText: "Start new assessment",
          cancelButtonText: "Close",
          customClass: { popup: "rounded-xl" },
        });

        if (isConfirmed && typeof onDownload === "function") onDownload();
        if (isDenied && typeof onNew === "function") onNew();
      }

      async function showSubmissionErrorModal({ message = "", onDownload }) {
        const { isConfirmed } = await Swal.fire({
          title: "Submission failed",
          html: `<p class="text-sm">${message || "Submission to server failed."}</p>`,
          icon: "error",
          showCancelButton: true,
          confirmButtonText: "Download PDF",
          cancelButtonText: "Close",
          customClass: { popup: "rounded-xl" },
        });

        if (isConfirmed && typeof onDownload === "function") onDownload();
      }

      /* ---------- Schema (unchanged) ---------- */
      const auditSchema = z.object({
        date: z.string().min(1, "Date is required"),
        facility_name: z.string().min(2, "Facility name is required"),
        facility_address: z.string().min(5, "Full address is required"),
        is_affiliated: z.boolean(),
        system_name: z.string().optional(),
        trauma_level: z.string().min(1, "Required"),
        contact_name: z.string().min(2, "Name required"),
        contact_title: z.string().min(1, "Title required"),
        contact_phone: z.string().min(7, "Valid phone required"),
        contact_email: z.string().email("Invalid email"),
        accrediting_name: z.string().min(1, "Org name required"),
        last_audit_date: z.string().min(1, "Audit date required"),
        has_findings: z.boolean(),
        findings: z.array(z.string()).max(4),
        reporting_to: z.string().min(1, "Required"),
        staff_ft_w_fmla: z.string().min(1, "Required"),
        staff_ft_no_fmla: z.string().min(1, "Required"),
        staff_pt: z.string().min(1, "Required"),
        staff_pd: z.string().min(1, "Required"),
        staff_travelers: z.string().min(1, "Required"),
        hours_operation: z.string().min(1, "Required"),
        or_count: z.string().min(1, "Required"),
        clinic_count: z.string().min(1, "Required"),
        proc_endoscopes: z.boolean(),
        proc_vascular: z.boolean(),
        proc_arthroscopic: z.boolean(),
        proc_robotic: z.boolean(),
        proc_tee: z.boolean(),
        has_tracking: z.boolean(),
        tracking_system_name: z.string().optional(),
        pain_points: z.string().min(1, "Please describe the pain points"),
        additional_info: z.string().optional(),
        bot_check: z.string().max(0),
      });

      /* ---------- UI primitives (unchanged) ---------- */
      const SectionShell = ({ kicker, title, children, description }) => (
        <section className="space-y-6">
          <div className="flex flex-col gap-1">
            {kicker && (
              <p className="text-[11px] font-semibold tracking-[0.2em] uppercase text-primary-600">
                {kicker}
              </p>
            )}
            {title && (
              <h2 className="font-semibold text-lg text-slate-900">{title}</h2>
            )}
            {description && (
              <p className="text-sm text-slate-500 max-w-2xl">{description}</p>
            )}
          </div>
          <div className="grid gap-6">{children}</div>
        </section>
      );

      const Field = ({ label, error, children, helper, className = "" }) => (
        <div className={`space-y-1.5 ${className}`}>
          <div className="flex items-baseline justify-between gap-3">
            <label className="text-xs font-semibold text-slate-600 tracking-wide">
              {label}
            </label>
            {helper && (
              <span className="text-[11px] text-slate-400">{helper}</span>
            )}
          </div>
          {children}
          {error && (
            <p className="text-rose-500 text-xs font-medium">{error}</p>
          )}
        </div>
      );

      const Input = (props) => (
        <input
          {...props}
          className={`w-full px-3.5 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500/40 focus:border-primary-500 transition-all ${props.className || ""}`}
        />
      );

      const RadioGroup = ({
        value,
        onChange,
        yesLabel = "Yes",
        noLabel = "No",
      }) => (
        <div className="inline-flex rounded-full bg-slate-100 p-1 border border-slate-200">
          <button
            type="button"
            onClick={() => onChange(true)}
            className={`px-4 py-1.5 text-xs font-semibold rounded-full transition-all ${value ? "bg-primary-600 text-white shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
          >
            {yesLabel}
          </button>
          <button
            type="button"
            onClick={() => onChange(false)}
            className={`px-4 py-1.5 text-xs font-semibold rounded-full transition-all ${!value ? "bg-rose-500 text-white shadow-sm" : "text-slate-500 hover:text-slate-700"}`}
          >
            {noLabel}
          </button>
        </div>
      );

      const Checkbox = ({ label, checked, onChange }) => (
        <label className="flex items-center gap-3 p-3 bg-slate-50 border border-slate-200 rounded-xl cursor-pointer hover:border-primary-400 hover:bg-primary-50/50 transition-colors text-sm">
          <input
            type="checkbox"
            checked={checked}
            onChange={(e) => onChange(e.target.checked)}
            className="w-4 h-4 rounded border-slate-300 text-primary-600 focus:ring-primary-500"
          />
          <span className="font-medium text-slate-700">{label}</span>
        </label>
      );

      const Select = ({ options, ...props }) => (
        <div className="relative">
          <select
            {...props}
            autoComplete="off"
            className={`w-full px-3.5 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-primary-500/40 focus:border-primary-500 appearance-none ${props.className || ""}`}
          >
            <option value="">Select level...</option>
            {options.map((opt) => (
              <option key={opt.value} value={opt.value}>
                {opt.label}
              </option>
            ))}
          </select>
          <span className="pointer-events-none absolute inset-y-0 right-3 flex items-center text-slate-400 text-xs">
            ▼
          </span>
        </div>
      );

      /* ---------- Main form component w/ Swal integration ---------- */
      const PreAuditForm = () => {
        const [formData, setFormData] = useState({
          date: today,
          facility_name: "",
          facility_address: "",
          is_affiliated: false,
          system_name: "",
          trauma_level: "",
          contact_name: "",
          contact_title: "",
          contact_phone: "",
          contact_email: "",
          accrediting_name: "",
          last_audit_date: "",
          has_findings: false,
          findings: ["", "", "", ""],
          reporting_to: "",
          staff_ft_w_fmla: "",
          staff_ft_no_fmla: "",
          staff_pt: "",
          staff_pd: "",
          staff_travelers: "",
          hours_operation: "",
          or_count: "",
          clinic_count: "",
          proc_endoscopes: false,
          proc_vascular: false,
          proc_arthroscopic: false,
          proc_robotic: false,
          proc_tee: false,
          has_tracking: false,
          tracking_system_name: "",
          pain_points: "",
          additional_info: "",
          bot_check: "",
        });

        const [errors, setErrors] = useState({});
        const [submittedData, setSubmittedData] = useState(null);
        const [isSubmitting, setIsSubmitting] = useState(false);
        const summaryRef = useRef(null);
        const formRef = useRef(null);
        const autosaveTimer = useRef(null);

        const showSuccessModal = async () => {
          const result = await Swal.fire({
            title: "Assessment Submitted!",
            html: `
        <div class="text-center space-y-5 mt-5">
          <p class="text-slate-700 text-base">
            Your SPD Pre-Audit Assessment for
            <br><strong>${formData.facility_name || "the facility"}</strong>
            has been successfully recorded.
          </p>
          <p class="text-sm text-slate-500">
            Thank you for your submission.<br>
            What would you like to do next?
          </p>
        </div>
      `,
            icon: "success",
            iconColor: "#a855f7",
            showConfirmButton: false,
            showDenyButton: true,
            denyButtonText: "Start New Assessment",
            denyButtonColor: "#6b7280",
            showCancelButton: true,
            cancelButtonText: "Close",
            cancelButtonColor: "#9333ea",
            reverseButtons: true,
            customClass: {
              popup: "rounded-2xl shadow-2xl max-w-lg",
              title: "text-2xl font-display font-semibold text-slate-800 pt-4",
              htmlContainer: "text-base",
              actions: "gap-4 mt-8",
              denyButton: "px-7 py-3.5 text-sm font-medium rounded-xl",
              cancelButton:
                "px-7 py-3.5 text-sm font-medium rounded-xl bg-primary-600 text-white hover:bg-primary-700",
            },
            backdrop: "rgba(15,23,42,0.65)",
          });

          if (result.isDenied) {
            // Reset form
            setFormData({
              date: today,
              facility_name: "",
              facility_address: "",
              is_affiliated: false,
              system_name: "",
              trauma_level: "",
              contact_name: "",
              contact_title: "",
              contact_phone: "",
              contact_email: "",
              accrediting_name: "",
              last_audit_date: "",
              has_findings: false,
              findings: ["", "", "", ""],
              reporting_to: "",
              staff_ft_w_fmla: "",
              staff_ft_no_fmla: "",
              staff_pt: "",
              staff_pd: "",
              staff_travelers: "",
              hours_operation: "",
              or_count: "",
              clinic_count: "",
              proc_endoscopes: false,
              proc_vascular: false,
              proc_arthroscopic: false,
              proc_robotic: false,
              proc_tee: false,
              has_tracking: false,
              tracking_system_name: "",
              pain_points: "",
              additional_info: "",
              bot_check: "",
            });
            setErrors({});
            localStorage.removeItem("preAuditDraft"); // optional: clear draft too
            window.scrollTo({ top: 0, behavior: "smooth" });
            showSuccessToast("Form cleared — ready for new assessment");
          }
          // If closed → form remains as submitted (useful for review)
          window.location.href = "/";
        };
        React.useEffect(() => {
          try {
            const draft = localStorage.getItem("preAuditDraft");
            if (draft) {
              setFormData((prev) => ({ ...prev, ...JSON.parse(draft) }));
              showSuccessToast("Draft loaded");
            }
          } catch (e) {
            console.warn("No draft found", e);
          }
        }, []);

        React.useEffect(() => {
          if (autosaveTimer.current) {
            clearTimeout(autosaveTimer.current);
          }
          autosaveTimer.current = setTimeout(() => {
            try {
              localStorage.setItem("preAuditDraft", JSON.stringify(formData));
            } catch (e) {
              console.warn("Cannot save draft:", e);
            }
          }, 600);
          return () => {
            if (autosaveTimer.current) clearTimeout(autosaveTimer.current);
          };
        }, [formData]);

        const saveDraftNow = useCallback(() => {
          try {
            localStorage.setItem("preAuditDraft", JSON.stringify(formData));
            showSuccessToast("Draft saved locally");
          } catch (e) {
            console.error(e);
            showErrorToast("Failed to save draft");
          }
        }, [formData]);

        const clearDraft = useCallback(() => {
          localStorage.removeItem("preAuditDraft");
          setFormData({
            date: today,
            facility_name: "",
            facility_address: "",
            is_affiliated: false,
            system_name: "",
            trauma_level: "",
            contact_name: "",
            contact_title: "",
            contact_phone: "",
            contact_email: "",
            accrediting_name: "",
            last_audit_date: "",
            has_findings: false,
            findings: ["", "", "", ""],
            reporting_to: "",
            staff_ft_w_fmla: "",
            staff_ft_no_fmla: "",
            staff_pt: "",
            staff_pd: "",
            staff_travelers: "",
            hours_operation: "",
            or_count: "",
            clinic_count: "",
            proc_endoscopes: false,
            proc_vascular: false,
            proc_arthroscopic: false,
            proc_robotic: false,
            proc_tee: false,
            has_tracking: false,
            tracking_system_name: "",
            pain_points: "",
            additional_info: "",
            bot_check: "",
          });
          showToast("Draft cleared");
        }, []);

        const handleSubmit = async (e) => {
          e.preventDefault();
          setIsSubmitting(true);
          const result = auditSchema.safeParse(formData);
          if (!result.success) {
            const fieldErrors = {};
            result.error.issues.forEach((i) => {
              const key = i.path[0];
              if (!fieldErrors[key]) fieldErrors[key] = i.message;
            });
            setErrors(fieldErrors);
            window.scrollTo({ top: 0, behavior: "smooth" });
            setIsSubmitting(false);
            return;
          }
          setErrors({});
          try {
            // Send to backend endpoint
            const response = await fetch(
              "https://api.crownpointconsult.com/api/gatekeeper",
              {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(formData),
              },
            );
            if (response.ok) {
              setSubmittedData(formData);
              await showSuccessModal();
              await showSubmissionModal({
                facilityName: formData.facility_name,
                onDownload: handleDownloadPdf,
                onNew: () => window.location.reload(),
              });
            } else {
              throw new Error("Submission failed");
            }
          } catch (error) {
            console.error("Submission error:", error);
            setSubmittedData(formData);
            window.location.href = "/";
            // Offer the user to download the local PDF since the server submission failed
          } finally {
            setIsSubmitting(false);
          }
        };

        return (
          <div className="space-y-8" ref={formRef}>
            <header className="text-center space-y-4">
              <p className="text-xs font-semibold tracking-[0.35em] uppercase text-primary-600">
                Crown Point Consulting
              </p>
              <h1 className="text-3xl md:text-4xl font-semibold text-slate-900 font-display tracking-tight">
                SPD Pre‑Audit Operational Review
              </h1>
              <p className="max-w-2xl mx-auto text-sm text-slate-500">
                Capture a concise snapshot of sterile processing operations,
                staffing, and survey readiness in a single structured
                assessment.
              </p>
            </header>

            <form
              onSubmit={handleSubmit}
              className="form-card p-6 md:p-10 space-y-10 border border-primary-50"
            >
              <input
                type="text"
                className="hp-field"
                value={formData.bot_check}
                onChange={(e) =>
                  setFormData({ ...formData, bot_check: e.target.value })
                }
                tabIndex="-1"
              />

              <SectionShell
                kicker="Section 1"
                title="Facility identity"
                description="Confirm basic identifying information for the facility and trauma designation."
              >
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <Field label="Assessment date" error={errors.date}>
                    <Input
                      type="date"
                      value={formData.date}
                      onChange={(e) =>
                        setFormData({ ...formData, date: e.target.value })
                      }
                    />
                  </Field>
                  <Field
                    label="Facility name"
                    error={errors.facility_name}
                    helper="As it appears on accreditation documents"
                  >
                    <Input
                      placeholder="e.g. Cedars-Sinai Medical Center"
                      value={formData.facility_name}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          facility_name: e.target.value,
                        })
                      }
                    />
                  </Field>
                </div>

                <Field
                  label="Facility Address"
                  error={errors.facility_address}
                  helper="Street, city, state, zip"
                >
                  <Input
                    placeholder="Enter your address"
                    autoComplete="address"
                    name="address"
                    value={formData.facility_address}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        facility_address: e.target.value,
                      })
                    }
                  />
                </Field>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 items-end bg-slate-50/80 p-5 rounded-2xl border border-slate-200">
                  <Field label="Health system affiliation?">
                    <RadioGroup
                      value={formData.is_affiliated}
                      onChange={(v) =>
                        setFormData({ ...formData, is_affiliated: v })
                      }
                    />
                  </Field>
                  {formData.is_affiliated && (
                    <Field
                      label="System name"
                      error={errors.system_name}
                      className="md:col-span-2"
                    >
                      <Input
                        placeholder="e.g. HCA Healthcare, Ascension, Tenet"
                        value={formData.system_name}
                        onChange={(e) =>
                          setFormData({
                            ...formData,
                            system_name: e.target.value,
                          })
                        }
                      />
                    </Field>
                  )}
                  <Field
                    label="Trauma level"
                    error={errors.trauma_level}
                    className={!formData.is_affiliated ? "md:col-span-2" : ""}
                  >
                    <Select
                      value={formData.trauma_level}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          trauma_level: e.target.value,
                        })
                      }
                      options={[
                        { value: "Level I", label: "Level I (Comprehensive)" },
                        { value: "Level II", label: "Level II (Major)" },
                        { value: "Level III", label: "Level III (General)" },
                        { value: "Level IV", label: "Level IV (Basic)" },
                        {
                          value: "Level V",
                          label: "Level V (Critical Access)",
                        },
                        { value: "N/A", label: "None/Non-Trauma Center" },
                      ]}
                    />
                  </Field>
                </div>
              </SectionShell>

              <SectionShell
                kicker="Section 2"
                title="Point of contact"
                description="Identify the primary leader who will coordinate the SPD review."
              >
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <Field label="Name" error={errors.contact_name}>
                    <Input
                      placeholder="Jane Doe"
                      autoComplete="name"
                      value={formData.contact_name}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          contact_name: e.target.value,
                        })
                      }
                    />
                  </Field>
                  <Field label="Title" error={errors.contact_title}>
                    <Input
                      placeholder="SPD Manager / Director of Sterile Processing"
                      value={formData.contact_title}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          contact_title: e.target.value,
                        })
                      }
                    />
                  </Field>
                  <Field label="Phone" error={errors.contact_phone}>
                    <Input
                      type="tel"
                      autoComplete="tel"
                      placeholder="(555) 000-0000"
                      value={formData.contact_phone}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          contact_phone: e.target.value,
                        })
                      }
                    />
                  </Field>
                  <Field label="Email" error={errors.contact_email}>
                    <Input
                      type="email"
                      placeholder="manager@hospital.org"
                      autoComplete="email"
                      value={formData.contact_email}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          contact_email: e.target.value,
                        })
                      }
                    />
                  </Field>
                </div>
              </SectionShell>

              <SectionShell
                kicker="Section 3"
                title="Regulatory context"
                description="Summarize accreditation and recent survey history related to sterile processing."
              >
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <Field
                    label="Accrediting body"
                    error={errors.accrediting_name}
                  >
                    <Input
                      placeholder="e.g. The Joint Commission (TJC), DNV, AAAHC"
                      value={formData.accrediting_name}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          accrediting_name: e.target.value,
                        })
                      }
                    />
                  </Field>
                  <Field
                    label="Last survey / audit date"
                    error={errors.last_audit_date}
                  >
                    <Input
                      type="date"
                      max={today}
                      value={formData.last_audit_date}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          last_audit_date: e.target.value,
                        })
                      }
                    />
                  </Field>
                </div>

                <div className="bg-slate-900 p-6 rounded-2xl space-y-4 border border-slate-700">
                  <div className="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                      <p className="text-xs font-semibold tracking-[0.2em] uppercase text-slate-400">
                        Recent SPD findings
                      </p>
                      <p className="mt-1 text-sm text-slate-200">
                        Indicate if the most recent accreditation or regulatory
                        survey cited sterile processing.
                      </p>
                    </div>
                    <div className="md:w-auto">
                      <RadioGroup
                        value={formData.has_findings}
                        onChange={(v) =>
                          setFormData({ ...formData, has_findings: v })
                        }
                        yesLabel="Yes, cited"
                        noLabel="No findings"
                      />
                    </div>
                  </div>

                  {formData.has_findings && (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                      {[0, 1, 2, 3].map((i) => (
                        <input
                          key={i}
                          placeholder={`Finding ${i + 1} (e.g. Bioburden on trays)`}
                          className="bg-slate-800/80 border border-slate-600 text-slate-50 placeholder:text-slate-400 p-3 rounded-lg text-sm focus:outline-none focus:border-primary-300 focus:ring-1 focus:ring-primary-400/60"
                          value={formData.findings[i]}
                          onChange={(e) => {
                            const newFindings = [...formData.findings];
                            newFindings[i] = e.target.value;
                            setFormData({ ...formData, findings: newFindings });
                          }}
                        />
                      ))}
                    </div>
                  )}
                </div>

                <Field
                  label="Direct reporting line"
                  error={errors.reporting_to}
                  helper="Role or department SPD reports into"
                >
                  <Input
                    name="reporting-line"
                    autoComplete="organization-title"
                    placeholder="e.g. Perioperative Director, Chief Nursing Officer"
                    value={formData.reporting_to}
                    onChange={(e) =>
                      setFormData({ ...formData, reporting_to: e.target.value })
                    }
                  />
                </Field>
              </SectionShell>

              <SectionShell
                kicker="Section 4"
                title="Staffing & scope"
                description="Outline current personnel mix and perioperative footprint."
              >
                <div className="grid grid-cols-2 md:grid-cols-5 gap-4">
                  <Field label="FT w/ FMLA" error={errors.staff_ft_w_fmla}>
                    <Input
                      type="number"
                      value={formData.staff_ft_w_fmla}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          staff_ft_w_fmla: e.target.value,
                        })
                      }
                    />
                  </Field>
                  <Field label="FT no FMLA" error={errors.staff_ft_no_fmla}>
                    <Input
                      type="number"
                      value={formData.staff_ft_no_fmla}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          staff_ft_no_fmla: e.target.value,
                        })
                      }
                    />
                  </Field>
                  <Field label="Part time" error={errors.staff_pt}>
                    <Input
                      type="number"
                      value={formData.staff_pt}
                      onChange={(e) =>
                        setFormData({ ...formData, staff_pt: e.target.value })
                      }
                    />
                  </Field>
                  <Field label="Per diem" error={errors.staff_pd}>
                    <Input
                      type="number"
                      value={formData.staff_pd}
                      onChange={(e) =>
                        setFormData({ ...formData, staff_pd: e.target.value })
                      }
                    />
                  </Field>
                  <Field label="Travelers" error={errors.staff_travelers}>
                    <Input
                      type="number"
                      value={formData.staff_travelers}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          staff_travelers: e.target.value,
                        })
                      }
                    />
                  </Field>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                  <Field
                    label="Hours of operation"
                    error={errors.hours_operation}
                    helper="e.g. 24/7 or 06:30–23:00"
                  >
                    <Input
                      placeholder="e.g. 24/7 or 06:30–23:00"
                      value={formData.hours_operation}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          hours_operation: e.target.value,
                        })
                      }
                    />
                  </Field>
                  <Field label="Main OR count" error={errors.or_count}>
                    <Input
                      type="number"
                      placeholder="12"
                      value={formData.or_count}
                      onChange={(e) =>
                        setFormData({ ...formData, or_count: e.target.value })
                      }
                    />
                  </Field>
                  <Field
                    label="Clinic / satellite areas"
                    error={errors.clinic_count}
                  >
                    <Input
                      type="number"
                      placeholder="4"
                      value={formData.clinic_count}
                      onChange={(e) =>
                        setFormData({
                          ...formData,
                          clinic_count: e.target.value,
                        })
                      }
                    />
                  </Field>
                </div>
              </SectionShell>

              <SectionShell
                kicker="Section 5"
                title="Processing scope & tracking"
                description="Identify high-complexity items processed in SPD and current tracking tools."
              >
                <Field label="Specialized items processed in SPD">
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mt-1">
                    <Checkbox
                      label="Flexible endoscopes"
                      checked={formData.proc_endoscopes}
                      onChange={(v) =>
                        setFormData({ ...formData, proc_endoscopes: v })
                      }
                    />
                    <Checkbox
                      label="Vascular / open heart"
                      checked={formData.proc_vascular}
                      onChange={(v) =>
                        setFormData({ ...formData, proc_vascular: v })
                      }
                    />
                    <Checkbox
                      label="Arthroscopic"
                      checked={formData.proc_arthroscopic}
                      onChange={(v) =>
                        setFormData({ ...formData, proc_arthroscopic: v })
                      }
                    />
                    <Checkbox
                      label="Robotic (daVinci)"
                      checked={formData.proc_robotic}
                      onChange={(v) =>
                        setFormData({ ...formData, proc_robotic: v })
                      }
                    />
                    <Checkbox
                      label="TEE probes"
                      checked={formData.proc_tee}
                      onChange={(v) =>
                        setFormData({ ...formData, proc_tee: v })
                      }
                    />
                  </div>
                </Field>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 items-end">
                  <Field label="Instrument tracking system?">
                    <RadioGroup
                      value={formData.has_tracking}
                      onChange={(v) =>
                        setFormData({ ...formData, has_tracking: v })
                      }
                    />
                  </Field>
                  {formData.has_tracking && (
                    <Field label="Tracking system name">
                      <Input
                        placeholder="e.g. Censis, SPM, T-DOC, CaseTrack"
                        value={formData.tracking_system_name}
                        onChange={(e) =>
                          setFormData({
                            ...formData,
                            tracking_system_name: e.target.value,
                          })
                        }
                      />
                    </Field>
                  )}
                </div>
              </SectionShell>

              <SectionShell
                kicker="Section 6"
                title="Narrative context"
                description="Highlight pain points and strategic considerations that should shape the review."
              >
                <Field
                  label="Major operational painpoints"
                  error={errors.pain_points}
                >
                  <textarea
                    className="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl min-h-[150px] focus:ring-2 focus:ring-primary-500/40 focus:border-primary-500 outline-none transition-all text-sm placeholder:text-slate-400"
                    placeholder="e.g. High turnover, backlogged sterilization, outdated washer-disinfectors..."
                    value={formData.pain_points}
                    onChange={(e) =>
                      setFormData({ ...formData, pain_points: e.target.value })
                    }
                  />
                </Field>

                <Field label="Additional strategic information">
                  <textarea
                    className="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl min-h-[100px] focus:ring-2 focus:ring-primary-500/40 focus:border-primary-500 outline-none transition-all text-sm placeholder:text-slate-400"
                    placeholder="Upcoming renovations, new service lines, capital planning, etc."
                    value={formData.additional_info}
                    onChange={(e) =>
                      setFormData({
                        ...formData,
                        additional_info: e.target.value,
                      })
                    }
                  />
                </Field>
              </SectionShell>

              <div className="flex flex-col sm:flex-row gap-3 pt-2">
                <button
                  type="button"
                  onClick={saveDraftNow}
                  className="flex-1 py-3 px-4 border border-slate-200 rounded-2xl font-semibold text-sm text-slate-700 hover:bg-slate-50 transition-all"
                >
                  Save Draft
                </button>
                <button
                  type="button"
                  onClick={clearDraft}
                  className="px-4 py-3 border border-rose-200 rounded-2xl font-semibold text-sm text-rose-600 hover:bg-rose-50 transition-all"
                >
                  Clear Form
                </button>
                <button
                  type="submit"
                  disabled={isSubmitting}
                  className="flex-1 py-3.5 bg-primary-600 text-white rounded-2xl font-semibold text-sm tracking-wide shadow-soft hover:bg-primary-700 hover:-translate-y-[1px] transition-all active:translate-y-0 active:shadow-md flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-none"
                >
                  <span>
                    {isSubmitting
                      ? "Submitting..."
                      : "Submit operational review"}
                  </span>
                  <svg
                    className="w-4 h-4"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth="2"
                      d="M13 5l7 7-7 7M5 5v14"
                    />
                  </svg>
                </button>
              </div>
            </form>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<PreAuditForm />);
    </script>
  </body>
</html>
